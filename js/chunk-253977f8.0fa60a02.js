(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-253977f8"],{"551f":function(t,e,s){"use strict";s("d785")},d583:function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"public-chat-container"},[s("Navbar",{attrs:{"initial-user":t.userData}}),s("section",{staticClass:"section-container"},[s("aside",{staticClass:"user-list"},[s("p",{staticClass:"user-list-title"},[t._v("上線使用者("+t._s(t.attendees.length)+")")]),s("ul",t._l(t.attendees,(function(e,n){return s("li",{key:n},[s("img",{attrs:{src:e.avatar,alt:""}}),s("span",{staticClass:"name"},[t._v(t._s(e.name))]),s("span",{staticClass:"account"},[t._v("@"+t._s(e.account))])])})),0)]),s("main",{staticClass:"room"},[s("p",{staticClass:"room-title"},[t._v("公開聊天室")]),s("div",{staticClass:"room-body"},t._l(t.msgs,(function(e,n){return s("div",{key:n},[s("div",{class:e.type},[s("span",[t._v(t._s(e.text))])]),s("div",{class:"connection"===e.type?"connection-time":"msg-in"===e.type?"msg-in-time":"msg-out-time"},[s("span",[t._v(t._s(e.time))])])])})),0),s("div",{staticClass:"room-footer"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.newMsg,expression:"newMsg"}],attrs:{type:"text",placeholder:"輸入訊息..."},domProps:{value:t.newMsg},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.sendMessage.apply(null,arguments)},input:function(e){e.target.composing||(t.newMsg=e.target.value)}}}),s("svg",{attrs:{width:"20",height:"21",viewBox:"0 0 20 21",fill:"none",xmlns:"http://www.w3.org/2000/svg"},on:{click:t.sendMessage}},[s("path",{attrs:{d:"M19.13 9.35798L1.614 0.107979C1.324 -0.0440207 0.973998 0.00597923 0.740999 0.233979C0.510999 0.459979 0.447999 0.810979 0.590999 1.10198L4.953 10.022L0.590999 18.942C0.447999 19.234 0.510999 19.585 0.740999 19.81C0.885998 19.95 1.074 20.022 1.264 20.022C1.384 20.022 1.504 19.994 1.614 19.935L19.131 10.685C19.376 10.555 19.531 10.299 19.531 10.021C19.531 9.74298 19.376 9.48898 19.131 9.35898L19.13 9.35798ZM2.948 2.50998L15.752 9.27198H6.255L2.948 2.51198V2.50998ZM6.255 10.77H15.753L2.948 17.535L6.255 10.772V10.77Z",fill:"#FF6600"}})])])])])],1)},o=[],a=s("5530"),c=s("1da1"),i=(s("96cf"),s("b0c0"),s("a9e3"),s("7db0"),s("4de4"),s("d178")),r=s("8e27"),u=s("2708"),l=s("c24f"),m=s("2fa3"),d={name:"PublicChatRoom",components:{Navbar:i["a"]},data:function(){return{userId:localStorage.getItem("user"),userData:{},msgs:[],newMsg:"",attendees:[],socket:Object(r["io"])("https://actwitter.herokuapp.com")}},methods:{fetchUser:function(t){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function s(){var n;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,l["a"].getUserInfo(t);case 3:if(n=s.sent,"OK"===n.statusText){s.next=6;break}throw new Error(n.statusText);case 6:e.userData=Object(a["a"])({},n.data),e.attendees.some((function(t){return t.id===e.userData.id}))||e.attendees.push({avatar:e.userData.avatar,name:e.userData.name,account:e.userData.account,id:e.userData.id}),e.msgs.push({text:"".concat(e.userData.name,"加入聊天"),type:"connection",time:"".concat(u["a"].formatTime)}),s.next=14;break;case 11:s.prev=11,s.t0=s["catch"](0),console.log("error",s.t0);case 14:case"end":return s.stop()}}),s,null,[[0,11]])})))()},socketStart:function(t){this.socket.emit("connectServer",t),this.socket.emit("read-notice",t),this.socket.emit("join-public-room",t),console.log("user ".concat(t," socket just started!"))},sendMessage:function(){this.msgs.push({text:this.newMsg,type:"msg-out",time:"".concat(u["a"].formatTime)}),this.socket.emit("public-msg",{userId:this.userId,message:this.newMsg}),this.newMsg=""},listenToServer:function(){var t=this;this.socket.on("notices",(function(t){console.log("notice",t)})),this.socket.on("read-notice",(function(t){console.log("read-notice",t)})),this.socket.on("public-chat-record",(function(t){console.log("publicChatRecord",t)})),this.socket.on("online-list",(function(t){console.log("inRoomUsers",t)})),this.socket.on("public-online-notice",function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(s){var n,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log(s,"joined room"),e.prev=1,e.next=4,l["a"].getUserInfo(s);case 4:if(n=e.sent,"OK"===n.statusText){e.next=7;break}throw new Error(n.statusText);case 7:o=Object(a["a"])({},n.data),t.attendees.some((function(t){return t.id===o.id}))||t.attendees.push({avatar:o.avatar,name:o.name,account:o.account,id:o.id}),t.msgs.push({text:"".concat(o.name,"加入聊天"),type:"connection",time:"".concat(u["a"].formatTime)}),e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](1),console.log("error",e.t0);case 15:case"end":return e.stop()}}),e,null,[[1,12]])})));return function(t){return e.apply(this,arguments)}}()),this.socket.on("public-offline-notice",(function(e){var s=Number(e),n=t.attendees.find((function(t){return t.id===s}));t.msgs.push({text:"".concat(n.name,"離開聊天室"),type:"connection",time:"".concat(u["a"].formatTime)}),t.attendees=t.attendees.filter((function(t){return t.id!==s})),console.log(e,"left room")})),this.socket.on("public-msg",(function(e){var s=e.userId,n=e.message;console.log("userId: ",s," ,message: ",n),t.msgs.push({text:"".concat(n),type:"msg-in",time:"".concat(u["a"].formatTime)})})),console.log("socket started listening!")},socketEnd:function(){this.socket.on("disconnect",(function(t){console.log("socket has disconnected for:",t)})),this.socket.disconnect(),m["a"].fire({title:"離開公開聊天室"})}},created:function(){Object(m["c"])(this),Object(m["d"])(this,"8347"),this.fetchUser(this.userId),this.socketStart(this.userId),this.listenToServer()},beforeDestroy:function(){this.socketEnd()}},f=d,h=(s("551f"),s("2877")),p=Object(h["a"])(f,n,o,!1,null,"7a00f7f4",null);e["default"]=p.exports},d785:function(t,e,s){}}]);
//# sourceMappingURL=chunk-253977f8.0fa60a02.js.map